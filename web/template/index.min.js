function create_mce(e=!1){e?$("textarea[id^='tinymce']").each(function(e,t){tinymce.init({selector:"#tinymce"+e,language:"zh_CN",inline:!1,plugins:"image",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | image",font_formats:"思源黑体=SourceHanSansCN-Medium",height:400,fontsize_formats:"14px",extended_valid_elements:["img[class=ud-margin|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name|style]","table[class=ud-margin|border|cellspacing|cellpadding|align|summary|bgcolor|width|height|style]"],template_cdate_format:"[CDATE: %m/%d/%Y : %H:%M:%S]",template_mdate_format:"[MDATE: %m/%d/%Y : %H:%M:%S]",autosave_ask_before_unload:!1,toolbar_mode:"wrap",paste_remove_styles_if_webkit:!0,setup:function(e){e.on("init",function(e){this.getBody().style.fontSize="14px",this.getBody().style.fontFamily="SourceHanSansCN-Medium"})},images_upload_handler:function(e,t,n){var a,i,o=e.blob();a=new XMLHttpRequest,a.withCredentials=!1,a.open("POST","/tinymce/upimgs.php"),a.onload=function(){var e;200==a.status?(e=JSON.parse(a.responseText),e&&"string"==typeof e.location?t(e.location):n("Invalid JSON: "+a.responseText)):n("HTTP Error: "+a.status)},i=new FormData,i.append("uploadkey",uploadkey),i.append("file",o,o.name),a.send(i)}})}):$("textarea[id^='tinymce']").each(function(e,t){tinymce.init({selector:"#tinymce"+e,language:"zh_CN",inline:!1,plugins:"paste print preview searchreplace autolink directionality visualblocks visualchars fullscreen image link media                         template codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount                         textpattern help emoticons autosave autoresize mathjax",toolbar:"code undo redo restoredraft | cut copy paste pastetext | forecolor backcolor bold italic underline strikethrough anchor | alignleft aligncenter alignright alignjustify outdent indent |                          formatselect fontselect fontsizeselect | bullist numlist | blockquote subscript superscript removeformat |                          table image media charmap emoticons hr pagebreak insertdatetime print preview | fullscreen | lineheight link mathjax",font_formats:"思源黑体=SourceHanSansCN-Medium",height:650,min_height:400,fontsize_formats:"14px 24px",extended_valid_elements:["img[class=ud-margin|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name|style]","table[class=ud-margin|border|cellspacing|cellpadding|align|summary|bgcolor|width|height|style]"],mathjax:{lib:OJ_CDN+"tinymce/plugins/mathjax/tex-mml-chtml.js",symbols:{start:"$",end:"$"}},template_cdate_format:"[CDATE: %m/%d/%Y : %H:%M:%S]",template_mdate_format:"[MDATE: %m/%d/%Y : %H:%M:%S]",autosave_ask_before_unload:!1,toolbar_mode:"wrap",paste_remove_styles_if_webkit:!0,setup:function(e){e.on("init",function(e){this.getBody().style.fontSize="14px",this.getBody().style.fontFamily="SourceHanSansCN-Medium"})},file_picker_callback:function(e,t,n){var a=".*",i="/tinymce/upfile.php";switch(n.filetype){case"image":a=".jpg, .jpeg, .png, .gif, .bmp",i="/tinymce/upimg.php";break;case"media":a=".mp3, .flac, .aac, .wav, .mp4, .mkv, .wmv, .avi, .flv"}var o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept",a),o.click(),o.onchange=function(){var t,n,a=this.files[0];console.log(a.name),t=new XMLHttpRequest,t.withCredentials=!1,t.open("POST",i),t.onload=function(){var n;200==t.status?(n=JSON.parse(t.responseText),n&&"string"==typeof n.location?e(n.location,{text:a.name}):failure("Invalid JSON: "+t.responseText)):failure("HTTP Error: "+t.status)},n=new FormData,n.append("file",a,a.name),n.append("uploadkey",uploadkey),t.send(n)}}})})}function admin_mod(){$("div[fd=source]").each(function(){let e=$(this).attr("pid");$(this).append("<span><label class='label label-success' pid='"+e+"' onclick='problem_add_source(this,"+e+");'>+</label></span>")}),$("span[fd=time_limit]").each(function(){let e=$(this),t=$(this).attr("pid");$(this).dblclick(function(){let n=e.text();console.log("pid:"+t+"  time_limit:"+n),e.html("<form onsubmit='return false;'><input type=hidden name='m' value='problem_update_time'><input type='hidden' name='pid' value='"+t+"'><input type='text' name='t' value='"+n+"' selected='true' class='input-mini' size=2 ></form>");let a=e.find("input[name=t]");a.focus(),a[0].select(),e.find("input").change(function(){let t=e.find("input[name=t]").val();$.post("admin/ajax.php",e.find("form").serialize()).done(function(){console.log("new time_limit:"+n),e.html(t)})})})})}function problem_add_source(e,t){console.log("pid:"+t);let n=$(e).parent();n.html("<form onsubmit='return false;'><input type='hidden' name='m' value='problem_add_source'><input type='hidden' name='pid' value='"+t+"'><input type='text' class='input input-large' name='ns'></form>"),n.find("input").focus(),n.find("input").change(function(){console.log(n.find("form").serialize());let e=n.find("input[name=ns]").val();console.log("new source:"+e),$.post("admin/ajax.php",n.find("form").serialize()),n.parent().append("<span class='label label-success'>"+e+"</span>"),n.html("<span class='label label-success' pid='"+t+"' onclick='problem_add_source(this,"+t+");'>+</span>")})}function vcode_required(e){return 0==$("input#vcode").length||(content=document.createElement("div"),content.setAttribute("class","row"),content.setAttribute("onsubmit","return set_val(this)"),content.setAttribute("style","padding:15px;"),HTMLcontent="<div class='col-xs-8'><input name='vcode' id='vcode-input' class='form-control' type='text' required autofocus></div>",HTMLcontent+="<div class='col-xs-4'><img id='vcode-img' alt='Click to change' src='vcode.php?"+Math.random()+" onclick='change_vcode(this)' height=auto autocomplete='off'></div>",content.innerHTML=HTMLcontent,swal({title:"验证码",content:content}).then(t=>{value=$("#vcode-input").val(),$("#vcode").val(value),e.submit()}),!1)}function change_vcode(e){return e.attr("src","vcode.php?"+Math.random()),!0}function CopyToClipboard(e){var t=e,n=!0;if(window.clipboardData)window.clipboardData.setData("Text",t);else{var a=CreateElementForExecCommand(t);SelectContent(a);try{window.netscape&&netscape.security&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),n=document.execCommand("copy",!1,null)}catch(e){n=!1}document.body.removeChild(a)}n?swal({text:"复制成功！",timer:1e3}):swal({text:"浏览器不允许网页使用剪切板！",timer:1e3})}function CreateElementForExecCommand(e){var t=document.createElement("pre");return t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.textContent=e,document.body.appendChild(t),t.contentEditable=!0,t}function SelectContent(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function getTotal(e){for(var t=0,n=0;n<e.length&&0==t;n++)try{t=parseInt(e[e.length-n].cells[0].innerHTML),isNaN(t)&&(t=0)}catch(e){}return t}function clock(){var e,t,n,a,i,o,r,l=new Date((new Date).getTime()+diff);i=l.getYear()+1900,i>3e3&&(i-=1900),o=l.getMonth()+1,r=l.getDate(),l.getDay(),e=l.getHours(),t=l.getMinutes(),n=l.getSeconds(),a=i+"-"+(o>=10?o:"0"+o)+"-"+(r>=10?r:"0"+r)+" "+(e>=10?e:"0"+e)+":"+(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n),document.getElementById("nowdate").innerHTML=a,setTimeout("clock()",1e3)}function checkFileList(e){"function"!=typeof window.FileReader&&error_msg("The file API isn't supported on this browser yet."),e.length>0&&readFile(e[0],"lhs"),e.length>1&&readFile(e[1],"rhs")}function readFile(e,t){var n=new FileReader;n.onload=function(){$("#path-"+t).text(e.name),$("#compare").mergely(t,n.result)},n.readAsBinaryString(e)}function handleDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function handleFileSelect(e){document.getElementById("drop_zone").visibility="collapse",e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;checkFileList(t)}function download_content(e,t){var n=$("#compare").mergely("get",t),a="data:plain/text;charset=UTF-8,"+encodeURIComponent(n);e.setAttribute("download",t+".txt"),e.setAttribute("href",a)}function print_result(e){sid=e,$.get("status-ajax.php?tr=1&solution_id="+e,function(e,t){$("#out").text(e)}),swal("测试结束")}function fresh_test_result(e){var t,n=window.document.getElementById("result");switch(e){case"-1":return swal("验证码错误"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click());case"-2":return swal("您的代码不符合填空格式"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click());case"-3":return swal("代码中有禁用的关键词或没有使用必须的关键词"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click())}sid=e,t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var a=t.responseText,i=a.split(","),o="<img width=18 style='margin:0 3px;' src='image/loading.gif'>";i[0]<4?"span disabled=true":11==i[0]?n.innerHTML="<a href='ceinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[i[0]]+"</a>":n.innerHTML="<a href='reinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[i[0]]+"</a>",i[0]<4&&(n.innerHTML+=o),n.innerHTML="Memory:"+i[1],n.innerHTML+=", Time:"+i[2],i[0]<4?window.setTimeout("fresh_test_result("+e+")",2e3):(window.setTimeout("print_result("+e+")",2e3),count=1)}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function getSID(){var e=document.getElementById("testRun").document,t="0";if(null==e){e=document.getElementById("testRun").contentWindow.document;var n=e;t=n.innerHTML}else{var a=document.frames.frame1.document;t=a.innerText}return t+""}function do_test_run(){handler_interval&&window.clearInterval(handler_interval);var e="<img width=18 style='margin:0 3px;' src='"+OJ_CDN+"image/loading.gif'>",t=window.document.getElementById("result");"undefined"!=typeof editor&&(source=editor.getValue(),$("#hide_source").val(source)),null!=t&&(t.innerHTML=e);var n=document.getElementById(mark);n.value=-n.value,document.getElementById("frmSolution").target="testRun",$.post("submit.php?ajax",$("#frmSolution").serialize(),function(e){fresh_test_result(e)}),$("#Submit").prop("disabled",!0),$("#TestRun").prop("disabled",!0),n.value=-n.value,count=20,handler_interval=window.setTimeout("resume();",1e3)}function get_full_code(){var e=$("pre#copy-blank").text();if($("input[name^=code]").each(function(t,n){e=e.replace("%*%",n.value)}),"undefined"!=typeof editors)for(var t=0;t<editors.length;t++){var n=/\n.*\*%\*/m.exec(e)[0].length,a=editors[t].getValue();a=a.replace("\n"," ".repeat(n)),e=e.replace("*%*",a,1)}return e}function switchLang(e){var t=new Array("c_cpp","c_cpp","pascal","java","ruby","sh","python","php","perl","csharp","objectivec","vbscript","scheme","c_cpp","c_cpp","lua","javascript","golang");editor.getSession().setMode("ace/mode/"+t[e])}function switchLangs(e){var t=new Array("c_cpp","c_cpp","pascal","java","ruby","sh","python","php","perl","csharp","objectivec","vbscript","scheme","c_cpp","c_cpp","lua","javascript","golang");editors.forEach(function(n){n.getSession().setMode("ace/mode/"+t[e])})}function replay(){replay_index=0,window.setTimeout("add()",1e3)}function sec2str(e){var t="";return e<36e3&&(t="0"),t+=parseInt(e/3600),t+=":",e%3600/60<10&&(t+="0"),t+=parseInt(e%3600/60),t+=":",e%60<10&&(t+="0"),t+=parseInt(e%60),t}function str2sec(e){var t=e.split(":"),n=parseInt(t[0]),a=parseInt(t[1]);t=parseInt(t[2]);return 3600*n+60*a+t}function colorful(e,t,n){n=n<0?-n:0,n*=10,n>255&&(n=255),t&&n>200&&(n=200);var a=t?n:255-n;e.style=t?"background-color: rgb("+a+",255,"+a+");":"background-color: rgb(255,"+a+","+a+");"}function update(e,t,n){var a=parseInt(n.num)+5,i=t.cells[a].innerHTML,o=0;if(""!=i&&(o=parseInt(i)),"-"==i.charAt(0)||""==i)if(4==parseInt(n.result)){if("-"==i.charAt(0)||""==i){var r=o;o=parseInt(n.in_date)-1200*o,penalty=str2sec(t.cells[4].innerHTML),penalty+=o,t.cells[4].innerHTML=sec2str(penalty),t.cells[a].innerHTML=sec2str(parseInt(n.in_date)),0!=r&&(t.cells[a].innerHTML+="("+r+")"),colorful(t.cells[a],!0,r)}else t.cells[a].className;t.cells[3].innerHTML=parseInt(t.cells[3].innerHTML)+1}else o--,t.cells[a].innerHTML=o,colorful(t.cells[a],!1,o)}function sort(e){for(var t=1;t<e.length;t++)for(var n=1;n<t;n++)cmp(e[t],e[n])&&swapNode(e[t],e[n])}function swapNode(e,t){var n=e.parentNode,a=e.nextSibling,i=t.nextSibling;$(e).fadeToggle("slow"),$(t).fadeToggle("slow"),a?n.insertBefore(t,a):n.appendChild(t),i?n.insertBefore(e,i):n.appendChild(e),$(e).fadeToggle("slow"),$(t).fadeToggle("slow")}function cmp(e,t){return parseInt(e.cells[3].innerHTML)>parseInt(t.cells[3].innerHTML)||(parseInt(e.cells[3].innerHTML)==parseInt(t.cells[3].innerHTML)?str2sec(e.cells[4].innerHTML)<str2sec(t.cells[4].innerHTML):void 0)}function trim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function newrow(e,t){var n="<tr><td></td><td>"+t.user_id+"</td>";n+="<td>"+trim(t.nick)+"</td>",n+="<td>";var a="grey",i=0;4==t.result?(n+="1",i=t.in_date,count=sec2str(i),a="well green"):(n+="0",a="well red",count=-1),n+="</td>";var o=e[0].rows[0].cells.length;n+="<td>"+sec2str(i)+"</td>";for(var r=5;r<o;r++)r-5==t.num?n+="<td class='"+a+"'>"+count+"</td>":n+="<td></td>";return n+="</tr>",n}function findrow(e,t){for(var n=e[0].rows,a=0;a<n.length;a++)if(n[a].cells[1].innerText==t.user_id)return n[a];return null}function explain(){for(var e=$("#errtxt").text(),t="",n=0;n<pats.length;n++){var a=pats[n],i=exps[n],o=a.exec(e);o&&(t+=o+" : "+i+"<br /><hr />")}document.getElementById("errexp").innerHTML=t}function showDownload(){var e=$("#errtxt").html();e=e.replace(/========\[(.*)\]=========/g,"<a href='download.php?sid=<?php echo $id?>&name=$1'>$1</a>"),$("#errtxt").html(e)}function auto_refresh(){interval=800;for(var e=window.document.getElementById("result-tab"),t=e.rows,n=t.length-1;n>0;n--){var a=$(t[n].cells[3].children[0]).attr("result");t[n].cells[3].className="td_result";var i=t[n].cells[0].innerText;if(a<4){window.setTimeout("fresh_result("+i+")",interval),console.log("auto_refresh "+i+" actived!");break}}}function findRow(e){for(var t=window.document.getElementById("result-tab"),n=t.rows,a=1;a<n.length;a++){var i=n[a].cells[0];if(i.innerText==e)return n[a]}}function fresh_result(e){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){window.document.getElementById("result-tab");var n=findRow(e),a=t.responseText,i=a.split(",");i[0]=parseInt(i[0]);var o="<img width=18 style='margin-left:3px;' src='"+OJ_CDN+"image/loading.gif'>";if(n.cells[4].innerHTML=i[1],n.cells[5].innerHTML=i[2],"none"!=i[3]&&(n.cells[9].innerHTML=i[3]),i[0]<4)-1==n.cells[3].innerHTML.indexOf("loading")&&(n.cells[3].innerHTML+=o),interval*=1.5,window.setTimeout("fresh_result("+e+")",interval);else{switch(i[0]){case 4:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[i[0]]+"'>"+judge_result[i[0]]+"</a>";break;case 5:case 6:case 7:case 8:case 9:case 10:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[i[0]]+"'>"+judge_result[i[0]]+" AC:"+i[4].trim()+"%</a>";break;case 11:n.cells[3].innerHTML="<a href=ceinfo.php?sid="+e+" class='"+judge_color[i[0]]+"'>"+judge_result[i[0]]+"</a>"}auto_refresh()}}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function http_judge(e){var t=$(e).parent()[0].children[0].value;return $.post("admin/problem_judge.php",$(e).parent().serialize(),function(e,n){"success"==n&&window.setTimeout("fresh_result("+t+")",1e3)}),!1}function changePos(){var e=document.getElementById("float"),t=document.documentElement.clientHeight,n=document.documentElement.clientWidth,a=document.getElementById("floatImg").height,i=document.getElementById("floatImg").width;e.style.left=parseInt(moveX+document.documentElement.scrollLeft)+"px",e.style.top=parseInt(moveY+document.documentElement.scrollTop)+"px",0==directionY?moveY+=stepY:moveY-=stepY,moveY<0&&(directionY=0,moveY=0),moveY>t-a&&(directionY=1,moveY=t-a),0==directionX?moveX+=stepX:moveX-=stepX,moveX<0&&(directionX=0,moveX=0),moveX>n-i&&(directionX=1,moveX=n-i)}function staticPos(){var e=document.getElementById("float"),t=document.documentElement.clientHeight,n=(document.documentElement.clientWidth,document.getElementById("floatImg").height);document.getElementById("floatImg").width;e.style.right=moveX+"px",e.style.top=parseInt(document.documentElement.scrollTop+t-n-moveY)+"px"}function setAD(e,t,n){var a=$(document.createElement("img")),i=$(document.createElement("a")),o=$(document.createElement("div"));a.appendTo(i),i.appendTo(o),i.attr("href",t),i.attr("target","_blank"),a.attr("id","floatImg"),a.attr("src",e),a.css("width","100px"),o.attr("id","float"),o.css("position","absolute"),o.css("z-index","1"),o.css("display","none"),o.appendTo("body"),n?(moveX=Math.round(Math.random()*document.documentElement.clientWidth),moveY=Math.round(Math.random()*document.documentElement.clientHeight),changePos(),setInterval(changePos,20)):(moveX=50,moveY=50,staticPos(),setInterval(staticPos,20)),o.css("display","")}$(document).ready(function(){$("form").append("<div id='csrf' />")}),$(".hint pre").each(function(){var e="<span class='glyphicon glyphicon-plus'>Click</span>",t=$(this);$(this).before(e),$(this).prev().click(function(){t.toggle()})}),$("table.ud-margin").each(function(e,t){table=$(t),table.parent().hasClass("table-responsive")||$(t).wrap("<div class='table-responsive'></div>")});var handler_interval,count=0,moveX=0,moveY=0,stepX=1,stepY=1,directionX=0,directionY=0;