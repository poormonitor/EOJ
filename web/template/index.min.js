function create_mce(e=!1){e?$("textarea[id^='tinymce']").each(function(e,t){tinymce.init({selector:"#tinymce"+e,language:"zh_CN",inline:!1,plugins:"image paste",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | paste image",font_formats:"SourceHanSansCN=SourceHanSansCN-Medium",height:400,fontsize_formats:"14px",extended_valid_elements:["img[class=ud-margin|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name|style]","table[class=ud-margin|border|cellspacing|cellpadding|align|summary|bgcolor|width|height|style]"],template_cdate_format:"[CDATE: %m/%d/%Y : %H:%M:%S]",template_mdate_format:"[MDATE: %m/%d/%Y : %H:%M:%S]",autosave_ask_before_unload:!1,toolbar_mode:"wrap",paste_remove_styles_if_webkit:!0,setup:function(e){e.on("init",function(e){this.getBody().style.fontSize="14px",this.getBody().style.fontFamily="SourceHanSansCN-Medium"})},relative_urls:!1,paste_data_images:!0,images_upload_handler:function(e,t,n,o){var a,r,i=e.blob();a=new XMLHttpRequest,a.withCredentials=!1,a.open("POST","/tinymce/upimgs.php"),a.upload.onprogress=function(e){o(e.loaded/e.total*100)},a.onload=function(){var e;200==a.status?(e=JSON.parse(a.responseText),e&&"string"==typeof e.location?t(e.location):n("Invalid JSON: "+a.responseText)):n("HTTP Error: "+a.status)},r=new FormData,r.append("uploadkey",uploadkey),r.append("file",i,i.name),a.send(r)}})}):$("textarea[id^='tinymce']").each(function(e,t){tinymce.init({selector:"#tinymce"+e,language:"zh_CN",inline:!1,plugins:"paste print preview searchreplace autolink directionality visualblocks visualchars fullscreen image link media                         template codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount                         textpattern help emoticons autosave autoresize mathjax code",toolbar:"code undo redo restoredraft | cut copy paste pastetext | forecolor backcolor bold italic underline strikethrough anchor | alignleft aligncenter alignright alignjustify outdent indent |                          formatselect fontselect fontsizeselect | bullist numlist | blockquote subscript superscript removeformat |                          table image media charmap emoticons hr pagebreak insertdatetime print preview | fullscreen | lineheight link mathjax",font_formats:"SourceHanSansCN=SourceHanSansCN-Medium",height:650,min_height:400,fontsize_formats:"14px 24px",extended_valid_elements:["img[class=ud-margin|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name|style]","table[class=ud-margin|border|cellspacing|cellpadding|align|summary|bgcolor|width|height|style]"],mathjax:{lib:OJ_CDN+"tinymce/plugins/mathjax/tex-mml-chtml.js",symbols:{start:"$",end:"$"}},template_cdate_format:"[CDATE: %m/%d/%Y : %H:%M:%S]",template_mdate_format:"[MDATE: %m/%d/%Y : %H:%M:%S]",autosave_ask_before_unload:!1,toolbar_mode:"wrap",paste_remove_styles_if_webkit:!0,setup:function(e){e.on("init",function(e){this.getBody().style.fontSize="14px",this.getBody().style.fontFamily="SourceHanSansCN-Medium"})},relative_urls:!1,file_picker_callback:function(e,t,n){var o=".*",a="/tinymce/upfile.php";switch(n.filetype){case"image":o=".jpg, .jpeg, .png, .gif, .bmp",a="/tinymce/upimg.php";break;case"media":o=".mp3, .flac, .aac, .wav, .mp4, .mkv, .wmv, .avi, .flv"}var r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept",o),r.click(),r.onchange=function(){var t,n,o=this.files[0];console.log(o.name),t=new XMLHttpRequest,t.withCredentials=!1,t.open("POST",a),t.onload=function(){var n;200==t.status?(n=JSON.parse(t.responseText),n&&"string"==typeof n.location?e(n.location,{text:o.name}):failure("Invalid JSON: "+t.responseText)):failure("HTTP Error: "+t.status)},n=new FormData,n.append("file",o,o.name),n.append("uploadkey",uploadkey),t.send(n)}}})})}function vcode_required(e){return 0==$("input#vcode").length||(content=document.createElement("div"),content.setAttribute("class","row"),content.setAttribute("onsubmit","return set_val(this)"),content.setAttribute("style","padding:15px;"),HTMLcontent="<div class='col-xs-8'><input name='vcode' id='vcode-input' class='form-control' type='text' required autofocus></div>",HTMLcontent+="<div class='col-xs-4'><img id='vcode-img' alt='Click to change' src='vcode.php?"+Math.random()+" onclick='change_vcode(this)' height=auto autocomplete='off'></div>",content.innerHTML=HTMLcontent,swal({title:langString.Vcode,content:content}).then(t=>{value=$("#vcode-input").val(),$("#vcode").val(value),e.submit()}),!1)}function change_vcode(e){return e.attr("src","vcode.php?"+Math.random()),!0}function CopyToClipboard(e){var t=e,n=!0;if(window.clipboardData)window.clipboardData.setData("Text",t);else{var o=CreateElementForExecCommand(t);SelectContent(o);try{window.netscape&&netscape.security&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),n=document.execCommand("copy",!1,null)}catch(e){n=!1}document.body.removeChild(o)}n?notyf.success(langString.Copied):notyf.error(langString.CopyForbidden)}function CreateElementForExecCommand(e){var t=document.createElement("pre");return t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.textContent=e,document.body.appendChild(t),t.contentEditable=!0,t}function SelectContent(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function getTotal(e){for(var t=0,n=0;n<e.length&&0==t;n++)try{t=parseInt(e[e.length-n].cells[0].innerHTML),isNaN(t)&&(t=0)}catch(e){}return t}function clock(){var e,t,n,o,a,r,i,l=new Date((new Date).getTime()+diff);a=l.getYear()+1900,a>3e3&&(a-=1900),r=l.getMonth()+1,i=l.getDate(),l.getDay(),e=l.getHours(),t=l.getMinutes(),n=l.getSeconds(),o=a+"-"+(r>=10?r:"0"+r)+"-"+(i>=10?i:"0"+i)+" "+(e>=10?e:"0"+e)+":"+(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n),getLeftTime(),document.getElementById("nowdate").innerHTML=o,setTimeout("clock()",1e3)}function padNumber(e,t){var n=(""+e).length;return Array(t>n&&t-n+1||0).join(0)+e}function getLeftTime(){$(".time-left").each(function(e,t){var n=$(t).text().match(/([\d]+)/g),o=TimeMinusOne(n),a="";for(e=0;e<o.length;e++)index=o.length-1-e,indexKeyword=langString.TimeKeyword.length-1-e,a=o[index]+" "+langString.TimeKeyword[indexKeyword]+" "+a;$(t).text(a)})}function TimeMinusOne(e){var t=e;if(1==t.length&&0==t[0])return t;for(var n=t.length-1;n>=0;n--){if(t[n]>0){t[n]=padNumber(t[n]-1,2);break}0!=n&&(t[n]=59)}return 0==t[0]&&(t=t.splice(0,1)),t}function checkFileList(e){"function"!=typeof window.FileReader&&error_msg("The file API isn't supported on this browser yet."),e.length>0&&readFile(e[0],"lhs"),e.length>1&&readFile(e[1],"rhs")}function readFile(e,t){var n=new FileReader;n.onload=function(){$("#path-"+t).text(e.name),$("#compare").mergely(t,n.result)},n.readAsBinaryString(e)}function handleDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function handleFileSelect(e){document.getElementById("drop_zone").visibility="collapse",e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;checkFileList(t)}function download_content(e,t,n){if("rhs"==t)var o=window.diffEditor.getModifiedEditor().getValue();else o=window.diffEditor.getOriginalEditor().getValue();var a="data:plain/text;charset=UTF-8,"+encodeURIComponent(o);e.setAttribute("download",n+".txt"),e.setAttribute("href",a)}function print_result(e){sid=e,$.get("status-ajax.php?tr=1&solution_id="+e,function(e,t){$("#out").text(e)}),notyf.success(langString.TestRunOver)}function fresh_test_result(e){var t,n=window.document.getElementById("result");switch(e){case"-1":return notyf.error(langString.VcodeWrong),n.innerHTML=langString.Status,void(null!=$("#vcode")&&$("#vcode").click());case"-2":return notyf.error(langString.FormatWrong),n.innerHTML=langString.Status,void(null!=$("#vcode")&&$("#vcode").click());case"-3":return notyf.error(langString.KeywordWrong),n.innerHTML=langString.Status,void(null!=$("#vcode")&&$("#vcode").click())}sid=e,t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText,a=o.split(","),r="<img width=18 style='margin:0 3px;' src='image/loading.gif'>";a[0]<4?"span disabled=true":11==a[0]?n.innerHTML="<a href='ceinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[a[0]]+"</a>":n.innerHTML="<a href='reinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[a[0]]+"</a>",a[0]<4&&(n.innerHTML+=r),n.innerHTML="Memory:"+a[1],n.innerHTML+=", Time:"+a[2],a[0]<4?window.setTimeout("fresh_test_result("+e+")",2e3):(window.setTimeout("print_result("+e+")",2e3),count=1)}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function getSID(){var e=document.getElementById("testRun").document,t="0";if(null==e){e=document.getElementById("testRun").contentWindow.document;var n=e;t=n.innerHTML}else{var o=document.frames.frame1.document;t=o.innerText}return t+""}function do_test_run(){handler_interval&&window.clearInterval(handler_interval);var e="<img width=18 style='margin:0 3px;' src='"+OJ_CDN+"image/loading.gif'>",t=window.document.getElementById("result");null!=t&&(t.innerHTML=e);var n=document.getElementById(mark);n.value=-n.value,document.getElementById("frmSolution").target="testRun";for(var o=$("#frmSolution").serializeArray(),a=0;a<o.length;a++)/((code|multiline)[0-9]?)|(source)/.test(o[a].name)&&(o[a].value=encode64(utf16to8(o[a].value)));$.post("submit.php?ajax",$.param(o),function(e){fresh_test_result(e)}),$("#Submit").prop("disabled",!0),$("#TestRun").prop("disabled",!0),n.value=-n.value,count=20,handler_interval=window.setTimeout("resume();",1e3)}function get_full_code(){var e=$("pre#copy-blank").text();if($("input[name^=code]").each(function(t,n){e=e.replace("%*%",n.value)}),void 0!==window.editors)for(var t=0;t<window.editors.length;t++){var n=/\n.*\*%\*/m.exec(e)[0].length,o=window.editors[t].getValue();o=o.replace("\n"," ".repeat(n)),e=e.replace("*%*",o,1)}return e}function switchLang(e){require(["vs/editor/editor.main"],function(){monaco.editor.setModelLanguage(window.editor.getModel(),language_monaco[e])})}function switchLangs(e){require(["vs/editor/editor.main"],function(){window.editors.forEach(function(t){monaco.editor.setModelLanguage(t.getModel(),language_monaco[e])})})}function replay(){replay_index=0,window.setTimeout("add()",1e3)}function sec2str(e){var t="";return e<36e3&&(t="0"),t+=parseInt(e/3600),t+=":",e%3600/60<10&&(t+="0"),t+=parseInt(e%3600/60),t+=":",e%60<10&&(t+="0"),t+=parseInt(e%60),t}function str2sec(e){var t=e.split(":"),n=parseInt(t[0]),o=parseInt(t[1]);t=parseInt(t[2]);return 3600*n+60*o+t}function colorful(e,t,n){n=n<0?-n:0,n*=10,n>255&&(n=255),t&&n>200&&(n=200);var o=t?n:255-n;e.style=t?"background-color: rgb("+o+",255,"+o+");":"background-color: rgb(255,"+o+","+o+");"}function update(e,t,n){var o=parseInt(n.num)+5,a=t.cells[o].innerHTML,r=0;if(""!=a&&(r=parseInt(a)),"-"==a.charAt(0)||""==a)if(4==parseInt(n.result)){if("-"==a.charAt(0)||""==a){var i=r;r=parseInt(n.in_date)-1200*r,penalty=str2sec(t.cells[4].innerHTML),penalty+=r,t.cells[4].innerHTML=sec2str(penalty),t.cells[o].innerHTML=sec2str(parseInt(n.in_date)),0!=i&&(t.cells[o].innerHTML+="("+i+")"),colorful(t.cells[o],!0,i)}else t.cells[o].className;t.cells[3].innerHTML=parseInt(t.cells[3].innerHTML)+1}else r--,t.cells[o].innerHTML=r,colorful(t.cells[o],!1,r)}function sort(e){for(var t=1;t<e.length;t++)for(var n=1;n<t;n++)cmp(e[t],e[n])&&swapNode(e[t],e[n])}function swapNode(e,t){var n=e.parentNode,o=e.nextSibling,a=t.nextSibling;$(e).fadeToggle("slow"),$(t).fadeToggle("slow"),o?n.insertBefore(t,o):n.appendChild(t),a?n.insertBefore(e,a):n.appendChild(e),$(e).fadeToggle("slow"),$(t).fadeToggle("slow")}function cmp(e,t){return parseInt(e.cells[3].innerHTML)>parseInt(t.cells[3].innerHTML)||(parseInt(e.cells[3].innerHTML)==parseInt(t.cells[3].innerHTML)?str2sec(e.cells[4].innerHTML)<str2sec(t.cells[4].innerHTML):void 0)}function trim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function newrow(e,t){var n="<tr><td></td><td>"+t.user_id+"</td>";n+="<td>"+trim(t.nick)+"</td>",n+="<td>";var o="grey",a=0;4==t.result?(n+="1",a=t.in_date,count=sec2str(a),o="well green"):(n+="0",o="well red",count=-1),n+="</td>";var r=e[0].rows[0].cells.length;n+="<td>"+sec2str(a)+"</td>";for(var i=5;i<r;i++)i-5==t.num?n+="<td class='"+o+"'>"+count+"</td>":n+="<td></td>";return n+="</tr>",n}function findrow(e,t){for(var n=e[0].rows,o=0;o<n.length;o++)if(n[o].cells[1].innerText==t.user_id)return n[o];return null}function explain(){for(var e=$("#errtxt").text(),t="",n=0;n<pats.length;n++){var o=pats[n],a=exps[n],r=o.exec(e);r&&(t+=r+" : "+a+"<br /><hr />")}document.getElementById("errexp").innerHTML=t}function auto_refresh(){interval=800;for(var e=window.document.getElementById("result-tab"),t=e.rows,n=t.length-1;n>0;n--){var o=$(t[n].cells[3].children[0]).attr("result");t[n].cells[3].className="td_result";var a=t[n].cells[0].innerText;if(o<4){window.setTimeout("fresh_result("+a+")",interval),console.log("auto_refresh "+a+" actived!");break}}}function findRow(e){for(var t=window.document.getElementById("result-tab"),n=t.rows,o=1;o<n.length;o++){var a=n[o].cells[0];if(a.innerText==e)return n[o]}}function fresh_result(e){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){window.document.getElementById("result-tab");var n=findRow(e),o=t.responseText,a=o.split(",");a[0]=parseInt(a[0]);var r="<img width=18 style='margin-left:3px;' src='"+OJ_CDN+"image/loading.gif'>";if(n.cells[4].innerHTML=a[1],n.cells[5].innerHTML=a[2],"none"!=a[3]&&(n.cells[9].innerHTML=a[3]),a[0]<4)-1==n.cells[3].innerHTML.indexOf("loading")&&(n.cells[3].innerHTML+=r),interval*=1.5,window.setTimeout("fresh_result("+e+")",interval);else{switch(a[0]){case 4:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+"</a>";break;case 5:case 6:case 7:case 8:case 9:case 10:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+" AC:"+a[4].trim()+"%</a>";break;case 11:n.cells[3].innerHTML="<a href=ceinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+"</a>"}auto_refresh()}}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function http_judge(e){var t=$(e).parent()[0].children[0].value;return $.post("admin/problem_judge.php",$(e).parent().serialize(),function(e,n){"success"==n&&window.setTimeout("fresh_result("+t+")",1e3)}),!1}function changePos(){var e=document.getElementById("float"),t=document.documentElement.clientHeight,n=document.documentElement.clientWidth,o=document.getElementById("floatImg").height,a=document.getElementById("floatImg").width;e.style.left=parseInt(moveX+document.documentElement.scrollLeft)+"px",e.style.top=parseInt(moveY+document.documentElement.scrollTop)+"px",0==directionY?moveY+=stepY:moveY-=stepY,moveY<0&&(directionY=0,moveY=0),moveY>t-o&&(directionY=1,moveY=t-o),0==directionX?moveX+=stepX:moveX-=stepX,moveX<0&&(directionX=0,moveX=0),moveX>n-a&&(directionX=1,moveX=n-a)}function staticPos(){var e=document.getElementById("float"),t=document.documentElement.clientHeight,n=(document.documentElement.clientWidth,document.getElementById("floatImg").height);document.getElementById("floatImg").width;e.style.right=moveX+"px",e.style.top=parseInt(document.documentElement.scrollTop+t-n-moveY)+"px"}function setAD(e,t,n){var o=$(document.createElement("img")),a=$(document.createElement("a")),r=$(document.createElement("div"));o.appendTo(a),a.appendTo(r),a.attr("href",t),a.attr("target","_blank"),o.attr("id","floatImg"),o.attr("src",e),o.css("width","100px"),r.attr("id","float"),r.css("position","absolute"),r.css("z-index","1"),r.css("display","none"),r.appendTo("body"),n?(moveX=Math.round(Math.random()*document.documentElement.clientWidth),moveY=Math.round(Math.random()*document.documentElement.clientHeight),changePos(),setInterval(changePos,20)):(moveX=50,moveY=50,staticPos(),setInterval(staticPos,20)),r.css("display","")}var langString={zh:{Vcode:"验证码",Copied:"复制成功",CopyForbidden:"浏览器不允许网页使用剪切板",TestRunOver:"测试运行结束",Status:"状态",VcodeWrong:"验证码错误",FormatWrong:"您的代码不符合填空格式",KeywordWrong:"代码中有禁用的关键词或没有使用必须的关键词",TimeKeyword:["天","小时","分","秒"]},en:{Vcode:"Verification Code",Copied:"Copied!",CopyForbidden:"The broswer does not allowed clipboard actions.",TestRunOver:"Test run finished.",Status:"Status",VcodeWrong:"Verification code is wrong.",FormatWrong:"The code does not match the template.",KeywordWrong:"Required keywords are not used in the code or Banned ones are used.",TimeKeyword:["days","hours","minutes","seconds"]}}[OJ_LANG],language_monaco=["c","cpp","pascal","java","ruby","bash","python","php","perl","csharp","objective-c","vb","scheme","c","cpp","lua","javascript","go","sql","fortran","matlab",""],notyf=new Notyf,isDarkMode=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches||"querySelector"in document&&!!document.querySelector("meta[name=darkreader]");$(document).ready(function(){$("form").append("<div id='csrf' />")}),$(".hint pre").each(function(){var e="<span class='glyphicon glyphicon-plus'>Click</span>",t=$(this);$(this).before(e),$(this).prev().click(function(){t.toggle()})}),$("table.ud-margin").each(function(e,t){table=$(t),table.parent().hasClass("table-responsive")||$(t).wrap("<div class='table-responsive'></div>")});var handler_interval,count=0,moveX=0,moveY=0,stepX=1,stepY=1,directionX=0,directionY=0;