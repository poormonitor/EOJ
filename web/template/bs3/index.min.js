function gtag(){dataLayer.push(arguments)}function admin_mod(){$("div[fd=source]").each(function(){let e=$(this).attr("pid");$(this).append("<span><span class='label label-success' pid='"+e+"' onclick='problem_add_source(this,"+e+");'>+</span></span>")}),$("span[fd=time_limit]").each(function(){let e=$(this),t=$(this).attr("pid");$(this).dblclick(function(){let n=e.text();console.log("pid:"+t+"  time_limit:"+n),e.html("<form onsubmit='return false;'><input type=hidden name='m' value='problem_update_time'><input type='hidden' name='pid' value='"+t+"'><input type='text' name='t' value='"+n+"' selected='true' class='input-mini' size=2 ></form>");let r=e.find("input[name=t]");r.focus(),r[0].select(),e.find("input").change(function(){let t=e.find("input[name=t]").val();$.post("admin/ajax.php",e.find("form").serialize()).done(function(){console.log("new time_limit:"+n),e.html(t)})})})})}function problem_add_source(e,t){console.log("pid:"+t);let n=$(e).parent();n.html("<form onsubmit='return false;'><input type='hidden' name='m' value='problem_add_source'><input type='hidden' name='pid' value='"+t+"'><input type='text' class='input input-large' name='ns'></form>"),n.find("input").focus(),n.find("input").change(function(){console.log(n.find("form").serialize());let e=n.find("input[name=ns]").val();console.log("new source:"+e),$.post("admin/ajax.php",n.find("form").serialize()),n.parent().append("<span class='label label-success'>"+e+"</span>"),n.html("<span class='label label-success' pid='"+t+"' onclick='problem_add_source(this,"+t+");'>+</span>")})}function vcode_required(e){return 0==$("input#vcode").length||(content=document.createElement("div"),content.setAttribute("class","row"),content.setAttribute("onsubmit","return set_val(this)"),content.setAttribute("style","padding:15px;"),content.innerHTML="<div class='col-xs-8'><input name='vcode' id='vcode-input' class='form-control' type='text' required autofocus></div><div class='col-xs-4'><img id='vcode-img' alt='click to change' src='vcode.php?' + Math.random() + '' onclick='change_vcode(this)' height=auto autocomplete='off'></div>",swal({title:"验证码",content:content}).then(t=>{value=$("#vcode-input").val(),$("#vcode").val(value),e.submit()}),!1)}function change_vcode(e){return e.attr("src","vcode.php?"+Math.random()),!0}function CopyToClipboard(e){var t=e,n=!0;if(window.clipboardData)window.clipboardData.setData("Text",t);else{var r=CreateElementForExecCommand(t);SelectContent(r);try{window.netscape&&netscape.security&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),n=document.execCommand("copy",!1,null)}catch(e){n=!1}document.body.removeChild(r)}n?swal("复制成功！"):swal("浏览器不允许网页使用剪切板！")}function CreateElementForExecCommand(e){var t=document.createElement("pre");return t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.textContent=e,document.body.appendChild(t),t.contentEditable=!0,t}function SelectContent(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function getTotal(e){for(var t=0,n=0;n<e.length&&0==t;n++)try{t=parseInt(e[e.length-n].cells[0].innerHTML),isNaN(t)&&(t=0)}catch(e){}return t}function clock(){var e,t,n,r,a,i,o,l=new Date((new Date).getTime()+diff);a=l.getYear()+1900,a>3e3&&(a-=1900),i=l.getMonth()+1,o=l.getDate(),l.getDay(),e=l.getHours(),t=l.getMinutes(),n=l.getSeconds(),r=a+"-"+(i>=10?i:"0"+i)+"-"+(o>=10?o:"0"+o)+" "+(e>=10?e:"0"+e)+":"+(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n),document.getElementById("nowdate").innerHTML=r,setTimeout("clock()",1e3)}function checkFileList(e){"function"!=typeof window.FileReader&&error_msg("The file API isn't supported on this browser yet."),e.length>0&&readFile(e[0],"lhs"),e.length>1&&readFile(e[1],"rhs")}function readFile(e,t){var n=new FileReader;n.onload=function(){$("#path-"+t).text(e.name),$("#compare").mergely(t,n.result)},n.readAsBinaryString(e)}function handleDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function handleFileSelect(e){document.getElementById("drop_zone").visibility="collapse",e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;checkFileList(t)}function download_content(e,t){var n=$("#compare").mergely("get",t),r="data:plain/text;charset=UTF-8,"+encodeURIComponent(n);e.setAttribute("download",t+".txt"),e.setAttribute("href",r)}function print_result(e){sid=e,$.get("status-ajax.php?tr=1&solution_id="+e,function(e,t){$("#out").text(e)}),swal("测试结束")}function fresh_test_result(e){var t,n=window.document.getElementById("result");switch(e){case"-1":return swal("验证码错误！"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click());case"-2":return swal("您的代码不符合填空格式！"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click());case"-3":return swal("代码中有禁用的关键词或没有使用必须的关键词！"),n.innerHTML="状态",void(null!=$("#vcode")&&$("#vcode").click())}sid=e,t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var r=t.responseText,a=r.split(","),i="<img width=18 style='margin-left:3px;' src='https://cdn.jsdelivr.net/gh/poormonitor/image@master/base/loading.gif'>";a[0]<4?"span disabled=true":11==a[0]?n.innerHTML="<a href='ceinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[a[0]]+"</a>":n.innerHTML="<a href='reinfo.php?sid="+e+"' class='badge badge-info' target=_blank>"+judge_result[a[0]]+"</a>",a[0]<4&&(n.innerHTML+=i),n.innerHTML="Memory:"+a[1],n.innerHTML+=", Time:"+a[2],a[0]<4?window.setTimeout("fresh_test_result("+e+")",2e3):(window.setTimeout("print_result("+e+")",2e3),count=1)}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function getSID(){var e=document.getElementById("testRun").document,t="0";if(null==e){e=document.getElementById("testRun").contentWindow.document;var n=e;t=n.innerHTML}else{var r=document.frames.frame1.document;t=r.innerText}return t+""}function do_test_run(){if(handler_interval&&window.clearInterval(handler_interval),""==$("input#vcode_input").val())return swal("验证码空！"),!1;var e="<img width=18 style='margin-left:3px;' src='https://cdn.jsdelivr.net/gh/poormonitor/image@master/base/loading.gif'>",t=window.document.getElementById("result"),n=$("#source").val();if("undefined"!=typeof editor&&(n=editor.getValue(),$("#hide_source").val(n)),n.length<10)return swal("代码过短!");null!=t&&(t.innerHTML=e);var r=document.getElementById(mark);r.value=-r.value,document.getElementById("frmSolution").target="testRun",$.post("submit.php?ajax",$("#frmSolution").serialize(),function(e){fresh_test_result(e)}),$("#Submit").prop("disabled",!0),$("#TestRun").prop("disabled",!0),r.value=-r.value,count=20,handler_interval=window.setTimeout("resume();",1e3)}function switchLang(e){var t=new Array("c_cpp","c_cpp","pascal","java","ruby","sh","python","php","perl","csharp","objectivec","vbscript","scheme","c_cpp","c_cpp","lua","javascript","golang");editor.getSession().setMode("ace/mode/"+t[e])}function openBlockly(){$("#frame_source").hide(),$("#TestRun").hide(),$("#language")[0].scrollIntoView(),$("#language").val(6).hide(),$("#language_span").hide(),$("#EditAreaArroundInfos_source").hide(),$("#blockly").html("<iframe name='frmBlockly' width=90% height=580 src='blockly/demos/code/index.html'></iframe>"),$("#blockly_loader").hide(),$("#transrun").show(),$("#Submit").prop("disabled",!0),using_blockly=!0}function translate(){var e=$(window.frames.frmBlockly.document),t=e.find("td[id=tab_python]"),n=e.find("pre[id=content_python]");t.click(),e.find("td[id=tab_blocks]").click(),"undefined"!=typeof editor?editor.setValue(n.text()):$("#source").val(n.text()),$("#language").val(6)}function loadFromBlockly(){translate(),do_test_run(),$("#frame_source").hide()}function replay(){replay_index=0,window.setTimeout("add()",1e3)}function sec2str(e){var t="";return e<36e3&&(t="0"),t+=parseInt(e/3600),t+=":",e%3600/60<10&&(t+="0"),t+=parseInt(e%3600/60),t+=":",e%60<10&&(t+="0"),t+=parseInt(e%60),t}function str2sec(e){var t=e.split(":"),n=parseInt(t[0]),r=parseInt(t[1]);t=parseInt(t[2]);return 3600*n+60*r+t}function colorful(e,t,n){n=n<0?-n:0,n*=10,n>255&&(n=255),t&&n>200&&(n=200);var r=t?n:255-n;e.style=t?"background-color: rgb("+r+",255,"+r+");":"background-color: rgb(255,"+r+","+r+");"}function update(e,t,n){var r=parseInt(n.num)+5,a=t.cells[r].innerHTML,i=0;if(""!=a&&(i=parseInt(a)),"-"==a.charAt(0)||""==a)if(4==parseInt(n.result)){if("-"==a.charAt(0)||""==a){var o=i;i=parseInt(n.in_date)-1200*i,penalty=str2sec(t.cells[4].innerHTML),penalty+=i,t.cells[4].innerHTML=sec2str(penalty),t.cells[r].innerHTML=sec2str(parseInt(n.in_date)),0!=o&&(t.cells[r].innerHTML+="("+o+")"),colorful(t.cells[r],!0,o)}else t.cells[r].className;t.cells[3].innerHTML=parseInt(t.cells[3].innerHTML)+1}else i--,t.cells[r].innerHTML=i,colorful(t.cells[r],!1,i)}function sort(e){for(var t=1;t<e.length;t++)for(var n=1;n<t;n++)cmp(e[t],e[n])&&swapNode(e[t],e[n])}function swapNode(e,t){var n=e.parentNode,r=e.nextSibling,a=t.nextSibling;$(e).fadeToggle("slow"),$(t).fadeToggle("slow"),r?n.insertBefore(t,r):n.appendChild(t),a?n.insertBefore(e,a):n.appendChild(e),$(e).fadeToggle("slow"),$(t).fadeToggle("slow")}function cmp(e,t){return parseInt(e.cells[3].innerHTML)>parseInt(t.cells[3].innerHTML)||(parseInt(e.cells[3].innerHTML)==parseInt(t.cells[3].innerHTML)?str2sec(e.cells[4].innerHTML)<str2sec(t.cells[4].innerHTML):void 0)}function trim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function newrow(e,t){var n="<tr><td></td><td>"+t.user_id+"</td>";n+="<td>"+trim(t.nick)+"</td>",n+="<td>";var r="grey",a=0;4==t.result?(n+="1",a=t.in_date,count=sec2str(a),r="well green"):(n+="0",r="well red",count=-1),n+="</td>";var i=e[0].rows[0].cells.length;n+="<td>"+sec2str(a)+"</td>";for(var o=5;o<i;o++)o-5==t.num?n+="<td class='"+r+"'>"+count+"</td>":n+="<td></td>";return n+="</tr>",n}function findrow(e,t){for(var n=e[0].rows,r=0;r<n.length;r++)if(n[r].cells[1].innerHTML==t.user_id)return n[r];return null}function explain(){for(var e=$("#errtxt").text(),t="",n=0;n<pats.length;n++){var r=pats[n],a=exps[n],i=r.exec(e);i&&(t+=i+" : "+a+"<br><hr />")}document.getElementById("errexp").innerHTML=t}function showDownload(){var e=$("#errtxt").html();e=e.replace(/========\[(.*)\]=========/g,"<a href='download.php?sid=<?php echo $id?>&name=$1'>$1</a>"),$("#errtxt").html(e)}function auto_refresh(){interval=800;for(var e=window.document.getElementById("result-tab"),t=e.rows,n=t.length-1;n>0;n--){var r=$(t[n].cells[3].children[0]).attr("result");t[n].cells[3].className="td_result";var a=t[n].cells[0].innerHTML;if(r<4){window.setTimeout("fresh_result("+a+")",interval),console.log("auto_refresh "+a+" actived!");break}}}function findRow(e){for(var t=window.document.getElementById("result-tab"),n=t.rows,r=1;r<n.length;r++){var a=n[r].cells[0];if(a.innerHTML==e)return n[r]}}function fresh_result(e){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){window.document.getElementById("result-tab");var n=findRow(e),r=t.responseText,a=r.split(",");a[0]=parseInt(a[0]);var i="<img width=18 style='margin-left:3px;' src='https://cdn.jsdelivr.net/gh/poormonitor/image@master/base/loading.gif'>";if(n.cells[4].innerHTML=a[1],n.cells[5].innerHTML=a[2],"none"!=a[3]&&(n.cells[9].innerHTML=a[3]),a[0]<4)-1==n.cells[3].innerHTML.indexOf("loading")&&(n.cells[3].innerHTML+=i),interval*=1.5,window.setTimeout("fresh_result("+e+")",interval);else{switch(a[0]){case 4:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+"</a>";break;case 5:case 6:case 7:case 8:case 9:case 10:n.cells[3].innerHTML="<a href=reinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+" AC:"+a[4].trim()+"%</a>";break;case 11:n.cells[3].innerHTML="<a href=ceinfo.php?sid="+e+" class='"+judge_color[a[0]]+"'>"+judge_result[a[0]]+"</a>"}auto_refresh()}}},t.open("GET","status-ajax.php?solution_id="+e,!0),t.send()}function http_judge(e){var t=$(e).parent()[0].children[0].value;return $.post("admin/problem_judge.php",$(e).parent().serialize(),function(e,n){"success"==n&&window.setTimeout("fresh_result("+t+")",1e3)}),!1}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-175545655-2"),$(document).ready(function(){$("form").append("<div id='csrf' />")}),$(".hint pre").each(function(){var e="<span class='glyphicon glyphicon-plus'>Click</span>",t=$(this);$(this).before(e),$(this).prev().click(function(){t.toggle()})});var handler_interval,count=0;